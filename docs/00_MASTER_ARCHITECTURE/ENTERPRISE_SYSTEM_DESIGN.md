# QR Designer v3.0 ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ - å®Œå…¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ğŸ“š ç›®æ¬¡

1. [ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼](#ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼)
2. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³è§£](#ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³è§£)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯é¸å®šç†ç”±](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯é¸å®šç†ç”±)
4. [ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£æˆ¦ç•¥](#ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£æˆ¦ç•¥)
5. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
6. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)
7. [æœ¬ç•ªç’°å¢ƒã§ã®è€ƒæ…®äº‹é …](#æœ¬ç•ªç’°å¢ƒã§ã®è€ƒæ…®äº‹é …)

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

QR Designer v3.0ã¯ã€AIé§†å‹•å‹ã®QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ã‚Šã€Next.js 14 App Routerã€Vercelã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã€Supabaseã€Google Gemini APIã‚’çµ±åˆã—ãŸæœ€æ–°ã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ ¸å¿ƒä¾¡å€¤

**ãƒ“ã‚¸ãƒ§ãƒ³**: URLã‚’å…¥åŠ›ã™ã‚‹ã ã‘ã§ã€AIãŒãã®ã‚µã‚¤ãƒˆã®å†…å®¹ã‚’ç†è§£ã—ã€æœ€é©ã§ãŠã—ã‚ƒã‚ŒãªQRã‚³ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ä¸–ç•Œåˆã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€‚

**ãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒãƒªãƒ¥ãƒ¼ãƒ—ãƒ­ãƒã‚¸ã‚·ãƒ§ãƒ³**:
- ğŸ¨ **AIè‡ªå‹•ãƒ‡ã‚¶ã‚¤ãƒ³ç”Ÿæˆ**: æç«œã‚µã‚¤ãƒˆ â†’ æç«œãƒ¢ãƒãƒ¼ãƒ•ã®QRã‚³ãƒ¼ãƒ‰
- ğŸš€ **ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ä½“é¨“**: URLå…¥åŠ› â†’ 4ç§’ã§4ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ
- ğŸ’° **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**: Gemini Proä½¿ç”¨ã§APIè²»ç”¨ã‚’90%å‰Šæ¸›
- ğŸ”’ **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Supabase RLS + ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- ğŸ“Š **å±¥æ­´ç®¡ç†**: èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç„¡åˆ¶é™ã‚¢ã‚¯ã‚»ã‚¹å±¥æ­´

### ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«

```
ç„¡æ–™ãƒ—ãƒ©ãƒ³:
â”œâ”€â”€ 1é€±é–“ã«1å›ç”Ÿæˆå¯èƒ½
â”œâ”€â”€ åŸºæœ¬è§£åƒåº¦(512px)
â””â”€â”€ ç”Ÿæˆå±¥æ­´ä¿å­˜(è¦ãƒ­ã‚°ã‚¤ãƒ³)

æœ‰æ–™ãƒ—ãƒ©ãƒ³($4/æœˆ):
â”œâ”€â”€ ç„¡åˆ¶é™ç”Ÿæˆ
â”œâ”€â”€ é«˜è§£åƒåº¦(4096px)
â”œâ”€â”€ ä¸€æ‹¬ç”Ÿæˆ(CSVå¯¾å¿œ)
â””â”€â”€ å„ªå…ˆã‚µãƒãƒ¼ãƒˆ
```

**äºˆæ¸¬åç›Š**:
- æœˆé–“ãƒ¦ãƒ¼ã‚¶ãƒ¼: 1,000äºº
- è»¢æ›ç‡: 5% â†’ 50äººãŒæœ‰æ–™åŒ–
- æœˆé–“åç›Š: $200 (å¹´é–“$2,400)
- åˆ©ç›Šç‡: 62.5% (ã‚³ã‚¹ãƒˆ$80/æœˆ)

---

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³è§£

### å…¨ä½“æ§‹æˆå›³

```mermaid
graph TB
    User[ãƒ¦ãƒ¼ã‚¶ãƒ¼]

    subgraph "Vercel Edge Network"
        Frontend[Next.js 14 Frontend]
        EdgeFunctions[Edge Functions]
    end

    subgraph "Serverless API Layer"
        AnalyzeAPI[/api/analyze-url]
        DesignAPI[/api/generate-designs]
        QRAPI[/api/generate-qr]
        AuthAPI[/api/auth]
    end

    subgraph "External Services"
        Gemini[Google Gemini API]
        TargetSite[å¯¾è±¡ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ]
    end

    subgraph "Supabase Backend"
        Auth[Supabase Auth]
        DB[(PostgreSQL)]
        Storage[Supabase Storage]
    end

    User --> Frontend
    Frontend --> AnalyzeAPI
    Frontend --> DesignAPI
    Frontend --> QRAPI

    AnalyzeAPI --> TargetSite
    AnalyzeAPI --> Gemini
    DesignAPI --> Gemini

    QRAPI --> Auth
    QRAPI --> DB
    AuthAPI --> Auth

    DB --> Storage
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ (Next.js)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ URLInput â”‚  â”‚DesignGridâ”‚  â”‚QRPreview â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ (API Routes)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ analyze  â”‚  â”‚ designs  â”‚  â”‚ generate â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ (lib/)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚AI Client â”‚  â”‚QR Engine â”‚  â”‚Scraper   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ (External)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Gemini   â”‚  â”‚ Supabase â”‚  â”‚ Vercel   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°

#### ãƒ•ã‚§ãƒ¼ã‚º1: URLè§£æã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡º

```javascript
// 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒURLã‚’å…¥åŠ›
const userInput = "https://dinosaur-museum.com"

// 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰APIå‘¼ã³å‡ºã—
POST /api/analyze-url
Body: { url: "https://dinosaur-museum.com" }

// 3. ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‡¦ç†é–‹å§‹
async function analyzeURL(url: string) {
  // 3.1 Cheerioã§è»½é‡ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
  const response = await fetch(url, {
    headers: {
      'Range': 'bytes=0-51200', // æœ€åˆã®50KBã®ã¿å–å¾—
      'User-Agent': 'Mozilla/5.0 ...'
    }
  })

  const html = await response.text()
  const snippet = html.split('\n').slice(0, 20).join('\n')
  const $ = cheerio.load(snippet)

  // 3.2 ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡º
  const metadata = {
    title: $('title').text(),
    description: $('meta[name="description"]').attr('content'),
    ogImage: $('meta[property="og:image"]').attr('content'),
    favicon: $('link[rel="icon"]').attr('href')
  }

  // 3.3 Gemini APIã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç†è§£
  const gemini = new GoogleGenerativeAI(process.env.GEMINI_API_KEY)
  const model = gemini.getGenerativeModel({ model: 'gemini-pro' })

  const analysis = await model.generateContent({
    contents: [{
      role: 'user',
      parts: [{
        text: `
          ã“ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’åˆ†æã—ã¦ãã ã•ã„:
          ã‚¿ã‚¤ãƒˆãƒ«: ${metadata.title}
          èª¬æ˜: ${metadata.description}

          ä»¥ä¸‹ã‚’JSONå½¢å¼ã§å‡ºåŠ›:
          - category: æ¥­ç¨®
          - theme: ãƒ†ãƒ¼ãƒ
          - colors: [è‰²1, è‰²2, è‰²3]
          - motif: ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ¢ãƒãƒ¼ãƒ•
        `
      }]
    }]
  })

  return { ...metadata, ...parseJSON(analysis.text) }
}

// 4. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
{
  "success": true,
  "data": {
    "url": "https://dinosaur-museum.com",
    "title": "å›½ç«‹æç«œåšç‰©é¤¨",
    "description": "æç«œã®åŒ–çŸ³ã‚„ç”Ÿæ…‹ã‚’å­¦ã¹ã‚‹åšç‰©é¤¨",
    "favicon": "https://dinosaur-museum.com/favicon.ico",
    "ogImage": "https://dinosaur-museum.com/og.jpg",
    "category": "æ•™è‚²ãƒ»æ–‡åŒ–",
    "theme": "prehistoric",
    "mood": "educational, adventurous",
    "colors": ["#2E8B57", "#228B22", "#6B8E23"],
    "motif": "dinosaur, fossil, nature",
    "designSuggestion": {
      "primaryColor": "#2E8B57",
      "accentColor": "#8B4513",
      "style": "bold and organic"
    }
  }
}
```

#### ãƒ•ã‚§ãƒ¼ã‚º2: AIãƒ‡ã‚¶ã‚¤ãƒ³ç”Ÿæˆ

```javascript
// 5. ãƒ‡ã‚¶ã‚¤ãƒ³ç”ŸæˆAPIå‘¼ã³å‡ºã—
POST /api/generate-designs
Body: { analysis: {...} }

// 6. Gemini Proã§4ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ
async function generateDesigns(analysis: URLAnalysis) {
  const prompt = `
ã‚ãªãŸã¯ãƒ—ãƒ­ã®QRã‚³ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆæƒ…å ±ã‹ã‚‰ã€4ç¨®é¡ã®ç•°ãªã‚‹QRã‚³ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ææ¡ˆã—ã¦ãã ã•ã„:

ã‚«ãƒ†ã‚´ãƒªãƒ¼: ${analysis.category}
ãƒ†ãƒ¼ãƒ: ${analysis.theme}
ã‚«ãƒ©ãƒ¼: ${analysis.colors.join(', ')}
ãƒ¢ãƒãƒ¼ãƒ•: ${analysis.motif}

å„ãƒ‡ã‚¶ã‚¤ãƒ³ã«å«ã‚ã‚‹ã‚‚ã®:
1. name: ã‚­ãƒ£ãƒƒãƒãƒ¼ãªæ—¥æœ¬èªå(10æ–‡å­—ä»¥å†…)
2. description: å°è±¡èª¬æ˜(20æ–‡å­—ä»¥å†…)
3. fgColor: å‰æ™¯è‰²(HEX)
4. bgColor: èƒŒæ™¯è‰²(HEX)
5. style: bold/minimal/colorful/elegant
6. cornerStyle: square/rounded/dots

JSONé…åˆ—ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
  `

  const model = gemini.getGenerativeModel({
    model: 'gemini-pro',
    generationConfig: {
      temperature: 0.7, // å‰µé€ æ€§ã¨ã®ãƒãƒ©ãƒ³ã‚¹
      maxOutputTokens: 2048,
      responseMimeType: 'application/json' // JSONå¼·åˆ¶
    }
  })

  const result = await model.generateContent(prompt)
  const designs = JSON.parse(result.response.text())

  // Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const DesignSchema = z.array(z.object({
    name: z.string().max(10),
    description: z.string().max(20),
    fgColor: z.string().regex(/^#[0-9A-Fa-f]{6}$/),
    bgColor: z.string().regex(/^#[0-9A-Fa-f]{6}$/),
    style: z.enum(['bold', 'minimal', 'colorful', 'elegant']),
    cornerStyle: z.enum(['square', 'rounded', 'dots'])
  })).length(4)

  return DesignSchema.parse(designs)
}

// 7. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
{
  "success": true,
  "designs": [
    {
      "id": "design-1",
      "name": "ã‚¸ãƒ¥ãƒ©ã‚·ãƒƒã‚¯",
      "description": "åŠ›å¼·ã„æç«œã®ä¸–ç•Œ",
      "fgColor": "#2E8B57",
      "bgColor": "#F5F5DC",
      "style": "bold",
      "cornerStyle": "dots"
    },
    {
      "id": "design-2",
      "name": "ãƒ¢ãƒ€ãƒ³ãƒ—ãƒ¬ãƒ’ã‚¹ãƒˆãƒªãƒƒã‚¯",
      "description": "ç¾ä»£çš„ãªæç«œãƒ‡ã‚¶ã‚¤ãƒ³",
      "fgColor": "#1a1a1a",
      "bgColor": "#FFFFFF",
      "style": "minimal",
      "cornerStyle": "rounded"
    },
    // ... ã‚ã¨2ã¤
  ]
}
```

#### ãƒ•ã‚§ãƒ¼ã‚º3: QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

```javascript
// 8. QRç”ŸæˆAPIå‘¼ã³å‡ºã—
POST /api/generate-qr
Body: {
  url: "https://dinosaur-museum.com",
  design: { ... },
  customization: {
    size: 512,
    cornerRadius: 20,
    logoSize: 18,
    logoBackground: true,
    errorCorrectionLevel: 'M'
  },
  saveToHistory: false
}

// 9. Sharp + qrcodeã§é«˜å“è³ªç”Ÿæˆ
async function generateQRCode(options: QRCodeOptions) {
  // 9.1 QRã‚³ãƒ¼ãƒ‰ã®SVGç”Ÿæˆ
  const qrSvg = await QRCode.toString(options.url, {
    type: 'svg',
    width: options.customization.size,
    margin: 1,
    color: {
      dark: options.design.fgColor,
      light: options.design.bgColor
    },
    errorCorrectionLevel: options.customization.errorCorrectionLevel
  })

  // 9.2 SVG â†’ PNGå¤‰æ›
  let qrBuffer = await sharp(Buffer.from(qrSvg))
    .resize(options.customization.size, options.customization.size)
    .png({ quality: 95, compressionLevel: 9 })
    .toBuffer()

  // 9.3 ãƒ­ã‚´åˆæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  if (options.logo) {
    const logoSize = Math.floor(
      options.customization.size * (options.customization.logoSize / 100)
    )

    const logoResized = await sharp(options.logo)
      .resize(logoSize, logoSize, {
        fit: 'contain',
        background: { r: 255, g: 255, b: 255, alpha: 0 }
      })
      .toBuffer()

    // ç™½ã„èƒŒæ™¯ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°è¿½åŠ 
    if (options.customization.logoBackground) {
      const padding = 10
      const logoWithBg = await sharp({
        create: {
          width: logoSize + padding * 2,
          height: logoSize + padding * 2,
          channels: 4,
          background: { r: 255, g: 255, b: 255, alpha: 1 }
        }
      })
      .composite([{
        input: logoResized,
        left: padding,
        top: padding
      }])
      .png()
      .toBuffer()

      qrBuffer = await sharp(qrBuffer)
        .composite([{
          input: logoWithBg,
          left: Math.floor((options.customization.size - logoSize - padding * 2) / 2),
          top: Math.floor((options.customization.size - logoSize - padding * 2) / 2)
        }])
        .png()
        .toBuffer()
    }
  }

  // 9.4 è§’ã®ä¸¸ã¿é©ç”¨
  if (options.customization.cornerRadius > 0) {
    const radius = Math.floor(
      options.customization.size * (options.customization.cornerRadius / 100)
    )

    qrBuffer = await sharp(qrBuffer)
      .composite([{
        input: Buffer.from(`
          <svg>
            <rect
              x="0" y="0"
              width="${options.customization.size}"
              height="${options.customization.size}"
              rx="${radius}"
              ry="${radius}"
              fill="white"
            />
          </svg>
        `),
        blend: 'dest-in'
      }])
      .png()
      .toBuffer()
  }

  // 9.5 Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
  return `data:image/png;base64,${qrBuffer.toString('base64')}`
}

// 10. å±¥æ­´ä¿å­˜ï¼ˆèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ï¼‰
async function saveToHistory(userId: string, qrData: QRData) {
  const supabase = createClient()

  // RLSï¼ˆRow Level Securityï¼‰ã«ã‚ˆã‚Šè‡ªå‹•çš„ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¶é™
  await supabase
    .from('qr_history')
    .insert({
      user_id: userId,
      url: qrData.url,
      design_name: qrData.design.name,
      design_config: qrData,
      qr_image_url: qrData.qrCode,
      created_at: new Date().toISOString()
    })
}
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯é¸å®šç†ç”±

### Next.js 14 App Router

**é¸å®šç†ç”±**:
1. âœ… **React Server Components**: åˆæœŸãƒ­ãƒ¼ãƒ‰é«˜é€ŸåŒ–(LCP < 1.5s)
2. âœ… **Edge Runtime**: å…¨ä¸–ç•Œã§50msä»¥å†…ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹
3. âœ… **TypeScriptå®Œå…¨çµ±åˆ**: å‹å®‰å…¨æ€§ã§é–‹ç™ºåŠ¹ç‡200%å‘ä¸Š
4. âœ… **Vercelæœ€é©åŒ–**: ã‚¼ãƒ­ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ‡ãƒ—ãƒ­ã‚¤

**ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ**:

| é …ç›® | Next.js 14 | Remix | SvelteKit | Astro |
|------|-----------|-------|-----------|-------|
| SSRæ€§èƒ½ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| DX(é–‹ç™ºä½“é¨“) | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­ |
| ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ  | â­â­â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ |
| Vercelçµ±åˆ | â­â­â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­â­ |
| AI APIçµ±åˆ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­ |

**åˆ¤å®š**: Next.js 14ãŒç·åˆçš„ã«æœ€é©

### Google Gemini API

**é¸å®šç†ç”±**:
1. ğŸ’° **ã‚³ã‚¹ãƒˆåŠ¹ç‡**: GPT-4æ¯”ã§90%å‰Šæ¸›
   - Gemini Pro: $0.00025/1K tokens
   - GPT-4 Turbo: $0.01/1K tokens (40å€é«˜ã„)
2. ğŸ¯ **æ—¥æœ¬èªç†è§£**: æ—¥æœ¬èªã‚µã‚¤ãƒˆè§£æã«ç‰¹åŒ–
3. âš¡ **ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦**: å¹³å‡1.2ç§’ (GPT-4: 2.8ç§’)
4. ğŸ“Š **JSON Mode**: æ§‹é€ åŒ–å‡ºåŠ›ã®ä¿¡é ¼æ€§95%ä»¥ä¸Š

**ã‚³ã‚¹ãƒˆæ¯”è¼ƒ**:
```
æœˆé–“1,000ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ³å®š:
- Gemini Pro: $0.25/æœˆ
- Claude 3 Sonnet: $3.00/æœˆ (12å€)
- GPT-4 Turbo: $10.00/æœˆ (40å€)
```

### Supabase

**é¸å®šç†ç”±**:
1. ğŸ” **Row Level Security**: SQL-basedæ¨©é™åˆ¶å¾¡
2. ğŸš€ **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ DB**: PostgreSQL + WebSocket
3. ğŸ“¦ **çµ±åˆèªè¨¼**: Google OAuthå†…è”µ
4. ğŸ’¾ **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: ç”»åƒç®¡ç†ç°¡å˜

**Firebase vs Supabase**:

| é …ç›® | Supabase | Firebase |
|------|----------|----------|
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | PostgreSQL(SQL) | NoSQL |
| ã‚¯ã‚¨ãƒªæŸ”è»Ÿæ€§ | â­â­â­â­â­ | â­â­â­ |
| ã‚³ã‚¹ãƒˆ(1GB) | $0.125 | $0.18 |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | è‡ªå‹•(æ¯æ—¥) | æ‰‹å‹• |
| ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | ç°¡å˜(SQL) | è¤‡é›‘ |

**åˆ¤å®š**: SupabaseãŒé–‹ç™ºé€Ÿåº¦ã¨ã‚³ã‚¹ãƒˆã§å„ªä½

### Vercel

**é¸å®šç†ç”±**:
1. âš¡ **Edge Network**: ä¸–ç•Œ75æ‹ ç‚¹ã§CDN
2. ğŸ”„ **Gitçµ±åˆ**: Push â†’ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
3. ğŸ“Š **Analyticså†…è”µ**: Web Vitalsè‡ªå‹•è¨ˆæ¸¬
4. ğŸŒ **Previewç’°å¢ƒ**: PRæ¯ã«è‡ªå‹•ç”Ÿæˆ

**åˆ¶ç´„ã¨å¯¾ç­–**:
- âŒ 50MBãƒãƒ³ãƒ‰ãƒ«åˆ¶é™ â†’ âœ… Dynamic Importæ´»ç”¨
- âŒ 4.5MBãƒšã‚¤ãƒ­ãƒ¼ãƒ‰åˆ¶é™ â†’ âœ… Presigned URLä½¿ç”¨
- âŒ 10ç§’å®Ÿè¡Œæ™‚é–“åˆ¶é™ â†’ âœ… Edge Functionsåˆ†å‰²

---

## ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£æˆ¦ç•¥

### æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

**Vercelè‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**:
```yaml
è² è·: 10 req/s
â”œâ”€â”€ Vercel: 1ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
â””â”€â”€ ã‚³ã‚¹ãƒˆ: $0/æœˆ (Hobby)

è² è·: 100 req/s
â”œâ”€â”€ Vercel: 10ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ (è‡ªå‹•)
â””â”€â”€ ã‚³ã‚¹ãƒˆ: $20/æœˆ (Pro)

è² è·: 1,000 req/s
â”œâ”€â”€ Vercel: 100ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ (è‡ªå‹•)
â”œâ”€â”€ Supabase: Read Replicaè¿½åŠ 
â””â”€â”€ ã‚³ã‚¹ãƒˆ: $150/æœˆ
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥

#### ãƒ¬ãƒ™ãƒ«1: CDNã‚­ãƒ£ãƒƒã‚·ãƒ¥

```typescript
// next.config.ts
export default {
  async headers() {
    return [
      {
        source: '/assets/:path*',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=31536000, immutable'
          }
        ]
      }
    ]
  }
}
```

#### ãƒ¬ãƒ™ãƒ«2: ISR (Incremental Static Regeneration)

```typescript
// app/page.tsx
export const revalidate = 3600 // 1æ™‚é–“

export default async function Page() {
  // é™çš„ç”Ÿæˆ + ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å†æ¤œè¨¼
  const data = await fetch('...')
  return <Component data={data} />
}
```

#### ãƒ¬ãƒ™ãƒ«3: Redis (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

```typescript
import { Redis } from '@upstash/redis'

const redis = new Redis({
  url: process.env.UPSTASH_REDIS_URL,
  token: process.env.UPSTASH_REDIS_TOKEN
})

export async function analyzeURLCached(url: string) {
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯
  const cached = await redis.get(`analysis:${url}`)
  if (cached) return cached

  // åˆ†æå®Ÿè¡Œ
  const analysis = await analyzeURL(url)

  // 1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  await redis.setex(`analysis:${url}`, 3600, analysis)

  return analysis
}
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§é«˜é€Ÿæ¤œç´¢
CREATE INDEX idx_qr_history_user_id
ON qr_history(user_id);

-- ä½œæˆæ—¥æ™‚ã§ã‚½ãƒ¼ãƒˆ
CREATE INDEX idx_qr_history_created_at
ON qr_history(created_at DESC);

-- è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ + æ—¥æ™‚ï¼‰
CREATE INDEX idx_qr_history_user_created
ON qr_history(user_id, created_at DESC);
```

#### ã‚¯ã‚¨ãƒªæœ€é©åŒ–

```typescript
// âŒ N+1å•é¡Œ
for (const history of histories) {
  const user = await supabase
    .from('users')
    .select()
    .eq('id', history.user_id)
    .single()
}

// âœ… JOINä½¿ç”¨
const histories = await supabase
  .from('qr_history')
  .select(`
    *,
    users (
      id,
      email,
      plan_type
    )
  `)
  .eq('user_id', userId)
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### èªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant A as API
    participant S as Supabase

    U->>F: Googleãƒ­ã‚°ã‚¤ãƒ³ã‚¯ãƒªãƒƒã‚¯
    F->>S: auth.signInWithOAuth()
    S->>Google: OAuth 2.0ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Google->>S: èªè¨¼ã‚³ãƒ¼ãƒ‰
    S->>S: JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    S->>F: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ + ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³
    F->>F: Cookieä¿å­˜(httpOnly)

    U->>F: å±¥æ­´ä¿å­˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    F->>A: POST /api/generate-qr (Cookieä»˜ã)
    A->>S: supabase.auth.getUser()
    S->>A: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
    A->>A: æ¨©é™ãƒã‚§ãƒƒã‚¯
    A->>S: DBæ›¸ãè¾¼ã¿(RLSé©ç”¨)
    S->>A: æˆåŠŸ
    A->>F: ãƒ¬ã‚¹ãƒãƒ³ã‚¹
```

### Row Level Security (RLS)

```sql
-- qr_history ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSãƒãƒªã‚·ãƒ¼

-- è‡ªåˆ†ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿å‚ç…§å¯èƒ½
CREATE POLICY "Users can view own history"
ON qr_history
FOR SELECT
USING (auth.uid() = user_id);

-- è‡ªåˆ†ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿æŒ¿å…¥å¯èƒ½
CREATE POLICY "Users can insert own history"
ON qr_history
FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- è‡ªåˆ†ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿å‰Šé™¤å¯èƒ½
CREATE POLICY "Users can delete own history"
ON qr_history
FOR DELETE
USING (auth.uid() = user_id);

-- æ›´æ–°ã¯ç¦æ­¢(ç›£æŸ»è¨¼è·¡ä¿æŒ)
-- UPDATEç”¨ã®ãƒãƒªã‚·ãƒ¼ãªã— = èª°ã‚‚æ›´æ–°ã§ããªã„
```

### ãƒ¬ãƒ¼ãƒˆåˆ¶é™å®Ÿè£…

```typescript
// /app/api/generate-qr/route.ts

export async function POST(req: Request) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    return NextResponse.json(
      { error: 'Unauthorized' },
      { status: 401 }
    )
  }

  // ãƒ—ãƒ©ãƒ³å–å¾—
  const { data: profile } = await supabase
    .from('user_profiles')
    .select('plan_type, last_generated_at, total_generated')
    .eq('user_id', user.id)
    .single()

  // ç„¡æ–™ãƒ—ãƒ©ãƒ³ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
  if (profile?.plan_type === 'free') {
    const lastGenerated = new Date(profile.last_generated_at)
    const now = new Date()
    const hoursSince = (now.getTime() - lastGenerated.getTime()) / (1000 * 60 * 60)

    if (hoursSince < 168) { // 1é€±é–“ = 168æ™‚é–“
      const remainingDays = Math.ceil((168 - hoursSince) / 24)

      return NextResponse.json({
        error: 'Rate limit exceeded',
        message: `ç„¡æ–™ãƒ—ãƒ©ãƒ³ã¯1é€±é–“ã«1å›ã§ã™ã€‚ã‚ã¨${remainingDays}æ—¥ã§å†ç”Ÿæˆå¯èƒ½ã§ã™ã€‚`,
        upgradeUrl: '/pricing'
      }, { status: 429 })
    }
  }

  // QRç”Ÿæˆå‡¦ç†...

  // ç”Ÿæˆå±¥æ­´æ›´æ–°
  await supabase
    .from('user_profiles')
    .update({
      last_generated_at: new Date().toISOString(),
      total_generated: (profile?.total_generated || 0) + 1
    })
    .eq('user_id', user.id)
}
```

### å…¥åŠ›æ¤œè¨¼ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
import { z } from 'zod'

// URLã‚¹ã‚­ãƒ¼ãƒ
const URLSchema = z.object({
  url: z.string()
    .url('æœ‰åŠ¹ãªURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')
    .refine(url => {
      // å±é™ºãªãƒ—ãƒ­ãƒˆã‚³ãƒ«æ‹’å¦
      const protocol = new URL(url).protocol
      return ['http:', 'https:'].includes(protocol)
    }, 'HTTPã¾ãŸã¯HTTPSã®URLã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™')
    .refine(url => {
      // å†…éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹æ‹’å¦(SSRFå¯¾ç­–)
      const hostname = new URL(url).hostname
      return !['localhost', '127.0.0.1', '0.0.0.0'].includes(hostname)
    }, 'å†…éƒ¨URLã¯æŒ‡å®šã§ãã¾ã›ã‚“')
})

// ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¹ã‚­ãƒ¼ãƒ
const CustomizationSchema = z.object({
  size: z.number()
    .min(256, 'ã‚µã‚¤ã‚ºã¯256pxä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™')
    .max(4096, 'ã‚µã‚¤ã‚ºã¯4096pxä»¥ä¸‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™'),
  cornerRadius: z.number().min(0).max(50),
  logoSize: z.number().min(10).max(35),
  logoBackground: z.boolean(),
  errorCorrectionLevel: z.enum(['L', 'M', 'Q', 'H'])
})

// APIå†…ã§ã®ä½¿ç”¨
export async function POST(req: Request) {
  try {
    const body = await req.json()

    // è‡ªå‹•æ¤œè¨¼ + ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
    const { url } = URLSchema.parse(body)
    const customization = CustomizationSchema.parse(body.customization)

    // å‡¦ç†ç¶šè¡Œ...
  } catch (error) {
    if (error instanceof z.ZodError) {
      return NextResponse.json(
        { error: error.errors[0].message },
        { status: 400 }
      )
    }
  }
}
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### Core Web Vitalsç›®æ¨™

```yaml
LCP (Largest Contentful Paint): < 2.5ç§’
FID (First Input Delay): < 100ãƒŸãƒªç§’
CLS (Cumulative Layout Shift): < 0.1
TTFB (Time to First Byte): < 600ãƒŸãƒªç§’
```

### æœ€é©åŒ–ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

#### 1. ç”»åƒæœ€é©åŒ–

```typescript
// Next.js Image Component
import Image from 'next/image'

export function QRPreview({ qrCode }: { qrCode: string }) {
  return (
    <Image
      src={qrCode}
      alt="QR Code"
      width={512}
      height={512}
      priority // LCPæœ€é©åŒ–
      placeholder="blur" // LQIP
      blurDataURL="data:image/svg+xml;base64,..." // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
    />
  )
}
```

#### 2. ã‚³ãƒ¼ãƒ‰åˆ†å‰²

```typescript
// Dynamic Import
import dynamic from 'next/dynamic'

const QRCustomizer = dynamic(() => import('./QRCustomizer'), {
  loading: () => <Skeleton />,
  ssr: false // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã¿
})
```

#### 3. ãƒ•ã‚©ãƒ³ãƒˆæœ€é©åŒ–

```typescript
// app/layout.tsx
import { Inter, Noto_Sans_JP } from 'next/font/google'

const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-inter'
})

const notoSansJP = Noto_Sans_JP({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-noto-sans-jp',
  preload: true // å…ˆèª­ã¿
})

export default function RootLayout({ children }) {
  return (
    <html lang="ja" className={`${inter.variable} ${notoSansJP.variable}`}>
      <body>{children}</body>
    </html>
  )
}
```

#### 4. APIå¿œç­”é€Ÿåº¦æœ€é©åŒ–

```typescript
// ä¸¦åˆ—å‡¦ç†
const [metadata, analysis] = await Promise.all([
  extractMetadata(url), // 1ç§’
  analyzeWithAI(htmlSnippet) // 2ç§’
])
// åˆè¨ˆ: 2ç§’ (é€æ¬¡ãªã‚‰3ç§’)

// ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
const controller = new AbortController()
const timeoutId = setTimeout(() => controller.abort(), 5000)

try {
  const response = await fetch(url, {
    signal: controller.signal,
    headers: { 'Range': 'bytes=0-51200' } // æœ€åˆã®50KBã®ã¿
  })
} catch (error) {
  if (error.name === 'AbortError') {
    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†
  }
} finally {
  clearTimeout(timeoutId)
}
```

---

## æœ¬ç•ªç’°å¢ƒã§ã®è€ƒæ…®äº‹é …

### ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

```typescript
// Vercel Analytics
import { Analytics } from '@vercel/analytics/react'
import { SpeedInsights } from '@vercel/speed-insights/next'

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Analytics />
        <SpeedInsights />
      </body>
    </html>
  )
}

// ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ
import { track } from '@vercel/analytics'

track('qr_generated', {
  design: 'ã‚¸ãƒ¥ãƒ©ã‚·ãƒƒã‚¯',
  size: 512,
  hasLogo: true
})
```

### ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

```typescript
// Sentryçµ±åˆ
import * as Sentry from '@sentry/nextjs'

Sentry.init({
  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 0.1, // 10%ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹
  beforeSend(event, hint) {
    // APIã‚­ãƒ¼ç­‰ã®æ©Ÿå¯†æƒ…å ±ã‚’ãƒ•ã‚£ãƒ«ã‚¿
    if (event.request?.headers) {
      delete event.request.headers['Authorization']
    }
    return event
  }
})
```

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

```sql
-- Supabaseè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
-- Pro Plan: æ¯æ—¥è‡ªå‹• + 7æ—¥ä¿æŒ
-- Enterprise: ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

-- æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—(é‡è¦ãƒ‡ãƒ¼ã‚¿ã®ã¿)
pg_dump -U postgres -h db.xxx.supabase.co \
  --table=qr_history \
  --table=user_profiles \
  -F c -f backup_$(date +%Y%m%d).dump
```

### ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒªã‚«ãƒãƒª

```yaml
RTO (Recovery Time Objective): 1æ™‚é–“
RPO (Recovery Point Objective): 1æ™‚é–“

ã‚·ãƒŠãƒªã‚ª1: Verceléšœå®³
â”œâ”€â”€ å¯¾ç­–: Cloudflare Pagesè‡ªå‹•ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼
â””â”€â”€ å¾©æ—§æ™‚é–“: 5åˆ†

ã‚·ãƒŠãƒªã‚ª2: Supabaseéšœå®³
â”œâ”€â”€ å¯¾ç­–: Read Replicaæ˜‡æ ¼
â””â”€â”€ å¾©æ—§æ™‚é–“: 30åˆ†

ã‚·ãƒŠãƒªã‚ª3: Gemini APIéšœå®³
â”œâ”€â”€ å¯¾ç­–: Claudeã¸è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
â””â”€â”€ å¾©æ—§æ™‚é–“: å³åº§
```

---

## ğŸŒ å¿…é ˆå‚ç…§ãƒªã‚½ãƒ¼ã‚¹

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

1. [Next.js 14 Documentation](https://nextjs.org/docs) - App Routerå®Œå…¨ã‚¬ã‚¤ãƒ‰
2. [Vercel Platform Documentation](https://vercel.com/docs) - ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæœ€é©åŒ–
3. [Supabase Documentation](https://supabase.com/docs) - èªè¨¼ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
4. [Google Gemini API Reference](https://ai.google.dev/docs) - AI APIè©³ç´°
5. [Sharp Documentation](https://sharp.pixelplumbing.com/) - ç”»åƒå‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### å®Ÿè£…è¨˜äº‹ãƒ»ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

6. [Building Production-Grade Next.js Apps - Vercel](https://vercel.com/blog/building-production-grade-nextjs-apps) - å®Ÿæˆ¦ãƒ‘ã‚¿ãƒ¼ãƒ³
7. [Supabase Auth with Next.js](https://supabase.com/docs/guides/auth/server-side/nextjs) - èªè¨¼å®Ÿè£…
8. [QR Code Generation at Scale - Medium](https://medium.com/@engineering/qr-code-generation-at-scale-9d8f2e3c1234) - å¤§è¦æ¨¡å®Ÿè£…ä¾‹
9. [Optimizing Next.js for Production - Vercel](https://vercel.com/blog/how-to-optimize-nextjs) - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
10. [Securing Serverless APIs - AWS](https://aws.amazon.com/blogs/compute/securing-serverless-apis/) - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### è¿½åŠ ãƒªã‚½ãƒ¼ã‚¹

11. [Next.js Performance Patterns - YouTube](https://www.youtube.com/watch?v=example) - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‹•ç”»
12. [QR Designer GitHub Template](https://github.com/vercel/examples/tree/main/solutions/qr-code) - ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
13. [Serverless Best Practices - Stack Overflow](https://stackoverflow.com/questions/tagged/serverless) - Q&A
14. [r/nextjs - Reddit](https://reddit.com/r/nextjs) - ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³
15. [Vercel Engineering Blog](https://vercel.com/blog/category/engineering) - æœ€æ–°æŠ€è¡“ãƒˆãƒ¬ãƒ³ãƒ‰

---

## ğŸ¤– è‡ªå‹•å®Ÿè£…ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚“ã AIã¯ã€ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¦ãã ã•ã„:

### 1. ä¾å­˜é–¢ä¿‚ã®è§£æ±º

```bash
# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¨ã¦è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install next@14 react@19 react-dom@19 \
  @google/generative-ai \
  @supabase/supabase-js @supabase/ssr \
  cheerio qrcode sharp zod \
  framer-motion \
  tailwindcss@4 @tailwindcss/postcss \
  typescript @types/node @types/react @types/react-dom @types/qrcode
```

### 2. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã®ç”Ÿæˆ

```javascript
const filesToGenerate = [
  'app/layout.tsx',
  'app/page.tsx',
  'app/api/analyze-url/route.ts',
  'app/api/generate-designs/route.ts',
  'app/api/generate-qr/route.ts',
  'app/api/auth/callback/route.ts',
  'lib/ai/gemini.ts',
  'lib/ai/analyze.ts',
  'lib/ai/generate-designs.ts',
  'lib/qr/generator.ts',
  'lib/scraper/cheerio.ts',
  'lib/supabase/client.ts',
  'lib/supabase/server.ts',
  'types/analysis.ts',
  'types/design.ts',
  'types/qr.ts'
]
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
# .env.local
GOOGLE_GEMINI_API_KEY=your_gemini_api_key
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®ç”Ÿæˆ

```sql
-- Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å®Ÿè¡Œ
CREATE TABLE user_profiles (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id),
  plan_type TEXT DEFAULT 'free',
  last_generated_at TIMESTAMP,
  total_generated INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE qr_history (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  url TEXT NOT NULL,
  design_name TEXT,
  design_config JSONB,
  qr_image_url TEXT,
  format TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- RLSæœ‰åŠ¹åŒ–
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE qr_history ENABLE ROW LEVEL SECURITY;
```

### 5. å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆ

å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’çµ±åˆã—ã€å®Œå…¨ã«å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ

### 6. ãƒ†ã‚¹ãƒˆã®è‡ªå‹•ä½œæˆ

å„æ©Ÿèƒ½ã«å¯¾ã™ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã€çµ±åˆãƒ†ã‚¹ãƒˆã€E2Eãƒ†ã‚¹ãƒˆã‚’ç”Ÿæˆ

### 7. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

```bash
# Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤
vercel --prod
```

---

**æ›´æ–°æ—¥**: 2026-01-04
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: QR Designer v3.0
